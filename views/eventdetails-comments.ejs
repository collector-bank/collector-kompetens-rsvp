<h3>
  Comments
</h3>

<% if (!user) { %>
  <p>
  Login to view or add comments.
  </p>
<% } else { %> 
  <% if (event.comments && event.comments.length > 0) { %>

    <p>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Date</th>
            <th scope="col">Message</th>
            <th scope="col">User</th>      
          </tr>
        </thead>
        <tbody>
            <%              
              let sortedComments = event.comments.slice();
              sortedComments.sort((a,b) => (a.createdAt > b.createdAt) ? 1 : ((b.createdAt > a.createdAt) ? -1 : 0)); 
            %>
            <% for(let comment of sortedComments) { %>
              <tr>
                <td style="min-width:200px"><%= moment(comment.createdAt).fromNow() %></td>
                <td width="60%"><%- markdown(comment.message) %></td>
                <td><%= comment.user ? comment.user.substring(0, comment.user.indexOf("@")) : "" %></td>
              </tr>
            <% } %>
        </tbody>
      </table>
    </p>

  <% } %>

  <form action="/api/events/<%= event._id %>/comments?route=<%=route%>" method="POST">

    <div class="form-group">
      <textarea class="form-control" id="message" name="message" rows="4"></textarea>
    </div>

    <div class="form-group">        
        <button type="submit" class="btn btn-primary btn-collector-purple" >Add</button>
    </div>
  </form>

<% } %>
